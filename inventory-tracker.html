<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Barcode Inventory Tracker</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
      position: relative;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    header h2 {
      margin: 0;
    }
    #logo {
      height: 48px; /* 20% smaller */
      width: auto;
    }
    label {
      display: block;
      margin-top: 12px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      font-size: 1em;
    }
    button {
      padding: 10px 16px;
      font-size: 1em;
      margin-top: 12px;
      margin-right: 10px;
      cursor: pointer;
    }
    #form-container {
      display: none;
    }
    table {
      margin-top: 25px;
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95em;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    #metalButtons button {
      margin: 5px 10px 5px 0;
      padding: 8px 14px;
      border: 1px solid #888;
      background-color: #eee;
      cursor: pointer;
    }
    #metalButtons button.active {
      background-color: #007bff;
      color: white;
      border-color: #0056b3;
    }
    #currentUser {
      font-weight: bold;
    }

    /* Scanner overlay styles */
    #scanner-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.8);
      display: none;
      z-index: 9999;
    }
    #scanner {
      width: 100%;
      height: 100%;
      position: relative;
    }
    #closeScannerBtn {
      position: absolute;
      top: 10px; right: 10px;
      z-index: 10000;
      padding: 10px 15px;
      background: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<header>
  <h2>Inventory Tracker</h2>
  <img src="Rea-logo.png" alt="REA Magnet Wire Logo" id="logo" />
</header>

<div id="login-container">
  <form id="loginForm" onsubmit="event.preventDefault(); login();">
    <label for="username">Enter Your Name:</label>
    <input type="text" id="username" autocomplete="off" />
    <button type="submit">Login</button>
  </form>
</div>

<div id="form-container">
  <p><strong>User:</strong> <span id="currentUser"></span></p>

  <label for="barcode">Scan/Enter Barcode:</label>
  <input type="text" id="barcode" autocomplete="off" />
  <button type="button" id="scanBtn">ðŸ“· Scan Barcode</button>

  <label for="weight">Weight (lbs):</label>
  <input type="number" id="weight" step="0.01" />

  <label>Metal Type:</label>
  <div id="metalButtons">
    <button type="button" onclick="setMetal(this, 'Aluminum')">Aluminum</button>
    <button type="button" onclick="setMetal(this, 'Alloy')">Alloy</button>
    <button type="button" onclick="setMetal(this, 'Copper')">Copper</button>
    <button type="button" onclick="setMetal(this, 'Brass')">Brass</button>
  </div>

  <label for="location">Select Location:</label>
  <select id="location" onchange="setLocation(this.value)">
    <option value="">--Choose--</option>
    <option value="Building 5">Building 5</option>
  </select>

  <button onclick="submitEntry()">Submit</button>
  <button onclick="exportCSV()">Export CSV</button>

  <table id="logTable">
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>User</th>
        <th>Barcode</th>
        <th>Weight</th>
        <th>Metal</th>
        <th>Location</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Scanner overlay -->
<div id="scanner-overlay">
  <button id="closeScannerBtn">Close</button>
  <div id="scanner"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<script>
  let currentUser = '';
  let currentLocation = '';
  let selectedMetal = '';
  const dataLog = [];

  function login() {
    const userInput = document.getElementById("username").value.trim();
    if (!userInput) return alert("Please enter a name.");
    currentUser = userInput;
    document.getElementById("currentUser").innerText = currentUser;
    document.getElementById("login-container").style.display = "none";
    document.getElementById("form-container").style.display = "block";
  }

  function setLocation(value) {
    currentLocation = value;
  }

  function setMetal(button, metalType) {
    selectedMetal = metalType;
    const buttons = document.querySelectorAll('#metalButtons button');
    buttons.forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');
  }

  function submitEntry() {
    const barcode = document.getElementById("barcode").value.trim();
    const weight = document.getElementById("weight").value.trim();
    const metal = selectedMetal;
    const location = currentLocation;

    if (!barcode || !weight || !metal || !location) {
      return alert("Please fill in all fields and select metal type and location.");
    }

    const timestamp = new Date().toISOString();
    const row = [timestamp, currentUser, barcode, weight, metal, location];
    dataLog.push(row);

    const tbody = document.getElementById("logTable").querySelector("tbody");
    const tr = document.createElement("tr");
    row.forEach(cell => {
      const td = document.createElement("td");
      td.innerText = cell;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);

    document.getElementById("barcode").value = '';
    document.getElementById("weight").value = '';
  }

  function exportCSV() {
    let csv = "Timestamp,User,Barcode,Weight,Metal,Location\n";
    dataLog.forEach(row => {
      csv += row.join(",") + "\n";
    });

    const blob = new Blob([csv], { type: 'text/csv' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "inventory_log.csv";
    link.click();
  }

  // Barcode Scanner logic using QuaggaJS
  const scanBtn = document.getElementById("scanBtn");
  const scannerOverlay = document.getElementById("scanner-overlay");
  const closeScannerBtn = document.getElementById("closeScannerBtn");

  scanBtn.addEventListener("click", () => {
    scannerOverlay.style.display = "block";

    Quagga.init({
      inputStream: {
        type : "LiveStream",
        target: document.querySelector('#scanner'),
        constraints: {
          facingMode: "environment" // Use back camera
        },
      },
      decoder: {
        readers: ["code_128_reader","ean_reader","ean_8_reader","code_39_reader","upc_reader","upc_e_reader","codabar_reader"],
      },
      locate: true,
    }, function(err) {
      if (err) {
        alert("Error initializing camera: " + err);
        scannerOverlay.style.display = "none";
        return;
      }
      Quagga.start();
    });

    Quagga.onDetected(function(result) {
      if(result && result.codeResult && result.codeResult.code) {
        document.getElementById("barcode").value = result.codeResult.code;
        Quagga.stop();
        scannerOverlay.style.display = "none";
      }
    });
  });

  closeScannerBtn.addEventListener("click", () => {
    Quagga.stop();
    scannerOverlay.style.display = "none";
  });
</script>

</body>
</html>

